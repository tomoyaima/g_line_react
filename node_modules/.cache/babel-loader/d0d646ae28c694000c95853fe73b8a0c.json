{"ast":null,"code":"var _jsxFileName = \"/Users/imatomo/Desktop/gline-react/src/components/index.js\";\nimport React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./post\";\nimport { db } from '../firebase';\nimport firebase from '../firebase';\nimport { BrowserRouter, Route, Link } from 'react-router-dom';\nimport { storage } from '../firebase';\nimport Login from \"./login\";\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.save = e => {\n      const user = firebase.auth().currentUser;\n\n      if (user) {\n        db.collection(\"users\").doc(user.uid).set({\n          name: user.displayName,\n          pic: user.photoURL || '/images/profile_placeholder.png',\n          email: user.email,\n          course: this.state.course,\n          nickname: this.state.nickname\n        }).then(() => {\n          this.setState({\n            usercourse: this.state.course\n          });\n          console.log(\"\\u8FFD\\u52A0\\u306B\\u6210\\u529F\\u3057\\u307E\\u3057\\u305F \");\n        }).catch(error => {\n          console.log(\"\\u8FFD\\u52A0\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F (\".concat(error, \")\"));\n        });\n      }\n    };\n\n    this.changepost = () => {\n      if (this.state.postpage == true) {\n        this.setState({\n          postpage: false\n        });\n      } else {\n        this.setState({\n          postpage: true\n        });\n      }\n    };\n\n    this.componentDidMount = () => {\n      const user = firebase.auth().currentUser;\n      console.log(this.props.user);\n\n      if (user) {\n        const userdb = db.collection(\"users\").doc(this.state.user.uid);\n        userdb.get().then(userdb => {\n          if (userdb.exists) {\n            this.setState({\n              usercourse: userdb.data().course\n            });\n            console.log(\"Document data:\", userdb.data());\n          }\n        });\n      }\n\n      const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc');\n      postsref.get().then(snapshot => {\n        const posts = snapshot.docs.map(postdoc => {\n          const post = postdoc.data();\n          const pathref = storage.ref(\"images/\".concat(post.postpicname));\n          pathref.getDownloadURL().then(url => {\n            this.setState({\n              pictureurl: url\n            });\n          });\n          return {\n            title: post.title,\n            body: post.body,\n            name: post.name,\n            pic: post.pic,\n            course: post.course,\n            nickname: post.nickname,\n            favcount: post.favcount,\n            librarycount: post.librarycount,\n            timestamp: post.timestamp,\n            postpicname: post.postpicname\n          };\n        });\n        this.setState({\n          posts: posts\n        });\n      });\n    };\n\n    this.state = {\n      posts: [],\n      postpage: false,\n      pictureurl: \"\",\n      usercourse: \"\"\n    };\n  }\n\n  render() {\n    console.log(this.props.user);\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, this.state.usercourse == \"\" ? React.createElement(Login, {\n      usercourse: this.state.usercourse,\n      save: this.save,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }) : this.state.posts.map((post, i) => {\n      return React.createElement(\"div\", {\n        key: i,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, post.title, post.body, post.name, React.createElement(\"img\", {\n        src: this.state.pictureurl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }), post.course, post.nickname, post.favcount, post.librarycount, post.timestamp.toString());\n    }), this.state.usercourse == \"\" ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }) : this.state.postpage ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, React.createElement(Post, {\n      user: this.state.user,\n      postpage: this.state.postpage,\n      changepost: this.changepost,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      onClick: this.changepost,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, \"\\u6295\\u7A3F\\u3092\\u3084\\u3081\\u308B\")) : React.createElement(\"button\", {\n      onClick: this.changepost,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }, \"\\u6295\\u7A3F\\u3059\\u308B\"));\n  }\n\n}\n\nexport default Index;","map":{"version":3,"sources":["/Users/imatomo/Desktop/gline-react/src/components/index.js"],"names":["React","Post","db","firebase","BrowserRouter","Route","Link","storage","Login","Index","Component","constructor","props","save","e","user","auth","currentUser","collection","doc","uid","set","name","displayName","pic","photoURL","email","course","state","nickname","then","setState","usercourse","console","log","catch","error","changepost","postpage","componentDidMount","userdb","get","exists","data","postsref","orderBy","snapshot","posts","docs","map","postdoc","post","pathref","ref","postpicname","getDownloadURL","url","pictureurl","title","body","favcount","librarycount","timestamp","render","i","toString"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./post\"\nimport { db } from '../firebase'\nimport firebase from '../firebase'\nimport { BrowserRouter, Route, Link } from 'react-router-dom'\nimport { storage } from '../firebase'\nimport Login from \"./login\";\n\nclass Index extends React.Component{\n    constructor(props){\n        super(props)\n        this.state={\n            posts:[],\n            postpage:false,\n            pictureurl:\"\",\n            usercourse:\"\"\n\n        }\n    }\n\n\n    save = (e) => {\n      \n        const user = firebase.auth().currentUser\n        if (user) {\n            db.collection(\"users\").doc(user.uid).set({\n                name: user.displayName,\n                pic: user.photoURL || '/images/profile_placeholder.png',\n                email: user.email,\n                course: this.state.course,\n                nickname: this.state.nickname\n            })\n                .then(() => {\n                    this.setState({\n                        usercourse : this.state.course\n                    })\n                    console.log(`追加に成功しました `);\n                })\n                .catch((error) => {\n                    console.log(`追加に失敗しました (${error})`);\n                });\n        }\n\n        \n    }\n\n    // usercoursecheck=()=>{\n    //     if(this.state.course==\"\"){\n    //         this.setState({\n    //             usercourse:\n    //         })\n    //     }else{\n    //         this.setState({\n    //             usercourse:true\n    //         })\n    //     }\n\n    // }\n\n    changepost=()=>{\n        if(this.state.postpage==true){\n            this.setState({\n                postpage:false\n            })\n        }else{\n            this.setState({\n                postpage:true\n            })\n        }\n\n    }\n\n\n\n    componentDidMount=()=>{\n        const user = firebase.auth().currentUser\n        \n        \n        console.log(this.props.user)\n        if (user) {\n        const userdb = db.collection(\"users\").doc(this.state.user.uid);\n        userdb.get().then((userdb) => {\n            if (userdb.exists) {\n                this.setState({\n                    usercourse:userdb.data().course\n                })\n                console.log(\"Document data:\", userdb.data());\n            }\n\n        }\n        )\n    }\n        \n        const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc')\n        postsref.get().then((snapshot) => {\n            const posts = snapshot.docs.map( (postdoc) =>{\n                \n                 const post = postdoc.data();\n                 const pathref = storage.ref(`images/${post.postpicname}`)\n                 pathref.getDownloadURL().then((url)=>{\n                     this.setState({\n                        pictureurl:url\n                     })\n                 }\n                 )\n\n                return {\n                    title:post.title,\n                    body:post.body,\n                    name:post.name,\n                    pic:post.pic,\n                    course:post.course,\n                    nickname: post.nickname,\n                    favcount: post.favcount,\n                    librarycount: post.librarycount,\n                    timestamp: post.timestamp,\n                    postpicname: post.postpicname\n                }   \n               \n            })\n            this.setState({\n                posts : posts,\n                \n            })\n           \n        });\n\n\n\n    }\n\n    \n\n   \n\n    render(){\n        console.log(this.props.user)\n        return(\n            <div>\n\n                {\n                    \n                    this.state.usercourse==\"\"?(\n                        <Login usercourse={this.state.usercourse} save={this.save}/>\n                    )\n                    :\n                    (\n                        \n                        this.state.posts.map((post, i) => { \n                                return ( \n                                    <div key={i}>\n                                        {post.title}\n                                        {post.body}\n                                        {post.name}\n                                        <img src={this.state.pictureurl}></img> \n                                    \n                                        {post.course}\n                                        {post.nickname}\n                                        {post.favcount}\n                                        {post.librarycount}\n                                        {post.timestamp.toString()}\n                                    </div>\n                                )\n\n                        })\n                      \n                    )   \n                }\n\n                {\n                    this.state.usercourse==\"\"?(\n                        <div></div>\n                    )\n\n                    :(\n                    this.state.postpage?(\n                        <div>\n                        <div><Post user = {this.state.user} postpage={this.state.postpage} changepost={this.changepost}/></div>\n                        <button onClick={this.changepost}>投稿をやめる</button>\n                        </div>\n                    )\n                    :\n                    (\n                        <button onClick={this.changepost}>投稿する</button>\n                    )\n                    )\n                }\n                 \n            </div>\n        );\n    }\n    \n}\n\nexport default Index"]},"metadata":{},"sourceType":"module"}