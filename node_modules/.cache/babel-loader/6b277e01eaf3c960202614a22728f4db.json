{"ast":null,"code":"import _objectSpread from \"/Users/imatomo/Desktop/gline-react/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/imatomo/Desktop/gline-react/src/components/Detail.js\";\nimport React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./Post\";\nimport { db } from '../firebase';\nimport firebase from '../firebase';\nimport { BrowserRouter, Route, Link } from 'react-router-dom';\nimport { storage } from '../firebase';\nimport Posts from \"./Posts\";\nimport Response from \"./Response\";\n\nclass Detail extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      post: [],\n      answered: false,\n      answerdisplay: false\n    };\n    this.answered = this.answered.bind(this);\n  }\n\n  componentWillMount() {\n    const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc');\n    postsref.limit(20).onSnapshot(snapshot => {\n      const posts = snapshot.docs.map(postdoc => {\n        const post = postdoc.data(); //  console.log(post);\n\n        if (post.postimageurl == []) {\n          console.log(post.postimageurl);\n          const pathref = storage.ref().child(\"images/\".concat(post.postimageurl));\n          pathref.getDownloadURL().then(url => {\n            this.setState(state => {\n              const index = state.posts.findIndex(post => {\n                return post.id === postdoc.id;\n              });\n              state.posts[index].postimageurl.push(url);\n              return state;\n            });\n          });\n        }\n\n        return _objectSpread({}, post, {\n          id: postdoc.id\n        });\n      });\n      console.log(posts);\n      const uid = this.props.match.params.id;\n      const post = posts.find(posts => {\n        return posts.id === uid;\n      });\n      const user = firebase.auth().currentUser;\n\n      if (user.email == post.email) {\n        this.setState({\n          answerdisplay: true\n        });\n      }\n\n      this.setState({\n        post: post\n      });\n    });\n  }\n\n  answered(isAnswered) {\n    this.setState(state => {\n      state.post.answered = isAnswered;\n    });\n    console.log(this.state.post);\n    console.log(this.state.post.answered);\n\n    const ansewredPost = _objectSpread({}, this.state.post, {\n      answered: this.state.post.answered\n    });\n\n    db.collection(\"posts\").doc(this.state.post.id).set(ansewredPost);\n  }\n\n  render() {\n    console.log(this.state.post.answered);\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, this.props.user && React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, this.state.post.title, this.state.post.body, this.state.post.name, this.state.post.pictureurl, this.state.post.course, this.state.post.nickname, this.state.post.favcount, this.state.post.librarycount, this.state.post.answered), this.state.answerdisplay ? this.state.post.answered ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: () => {\n        this.answered(false);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, \"\\u56DE\\u7B54\\u6E08\\u307F\\u53D6\\u308A\\u6D88\\u3057\")) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: () => {\n        this.answered(true);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, \"\\u56DE\\u7B54\\u6E08\\u307F\\u306B\\u3059\\u308B\")) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), React.createElement(Response, {\n      match: this.props.match,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default Detail;","map":{"version":3,"sources":["/Users/imatomo/Desktop/gline-react/src/components/Detail.js"],"names":["React","Post","db","firebase","BrowserRouter","Route","Link","storage","Posts","Response","Detail","Component","constructor","props","state","post","answered","answerdisplay","bind","componentWillMount","postsref","collection","orderBy","limit","onSnapshot","snapshot","posts","docs","map","postdoc","data","postimageurl","console","log","pathref","ref","child","getDownloadURL","then","url","setState","index","findIndex","id","push","uid","match","params","find","user","auth","currentUser","email","isAnswered","ansewredPost","doc","set","render","title","body","name","pictureurl","course","nickname","favcount","librarycount"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./Post\"\nimport { db } from '../firebase'\nimport firebase from '../firebase'\nimport { BrowserRouter, Route, Link } from 'react-router-dom'\nimport { storage } from '../firebase'\nimport Posts from \"./Posts\";\nimport Response from \"./Response\"\n\nclass Detail extends React.Component{\n    constructor(props){\n        super(props)\n        this.state={\n           post:[],\n           answered:false,\n           answerdisplay:false\n        }\n        this.answered=this.answered.bind(this)\n    }\n\n  \n    componentWillMount(){\n\n        \n\n        const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc')\n        postsref.limit(20).onSnapshot((snapshot) => {\n            const posts = snapshot.docs.map( (postdoc) =>{\n                \n                const post = postdoc.data();\n                    //  console.log(post);\n                if(post.postimageurl ==[]){\n                    console.log(post.postimageurl)\n                    const pathref = storage.ref().child(`images/${post.postimageurl}`)\n                    pathref.getDownloadURL().then((url)=>{ \n\n                        this.setState((state)=>{\n                            const index =  state.posts.findIndex((post)=>{\n                                return post.id === postdoc.id;\n                            })\n                            state.posts[index].postimageurl.push(url)\n\n\n                            \n                            return state\n                        })\n                    })\n\n                    \n                }\n                return {...post,id:postdoc.id}\n                \n               \n            })\n            console.log(posts)\n            const uid =this.props.match.params.id\n            const post= posts.find((posts) => {return (posts.id === uid);})\n            const user = firebase.auth().currentUser\n            if(user.email==post.email){\n                this.setState({\n                answerdisplay:true\n                })\n            }\n            this.setState({\n                post:post\n            })\n           \n        });\n       \n       \n    \n    }\n    answered(isAnswered){\n        this.setState((state)=>{\n            state.post.answered=isAnswered\n            \n        })\n        console.log(this.state.post);\n        console.log(this.state.post.answered);\n        const ansewredPost = {\n            ...this.state.post,\n            answered: this.state.post.answered\n        }\n        db.collection(\"posts\").doc(this.state.post.id).set(ansewredPost)        \n        \n    }\n   \n\n    render(){\n        console.log(this.state.post.answered)\n        return(\n            <div>\n\n                {this.props.user&&\n                     \n                    \n                           <div>\n                                {this.state.post.title}\n                                {this.state.post.body}\n                                {this.state.post.name}\n                                {this.state.post.pictureurl}\n                               \n                                {this.state.post.course}\n                                {this.state.post.nickname}\n                                {this.state.post.favcount}\n                                {this.state.post.librarycount}\n                                {this.state.post.answered}\n                               \n                            </div> \n                         \n                           \n                   \n                }\n\n                {this.state.answerdisplay?(\n                    this.state.post.answered?(\n                    <div>\n                        <button onClick={()=>{this.answered(false)}}>回答済み取り消し</button>\n                    </div>\n                )\n                :\n                (\n                    <div>\n                    <button onClick={()=>{this.answered(true)}}>回答済みにする</button>\n                    </div>\n                )\n                ):(<div></div>)\n                }\n            \n            <Response match={this.props.match}/>\n            </div>\n        )\n    }\n}\n\nexport default Detail\n"]},"metadata":{},"sourceType":"module"}