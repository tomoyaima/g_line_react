{"ast":null,"code":"var _jsxFileName = \"/Users/imatomo/Desktop/gline-react/src/components/Mypage.js\";\nimport React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./Post\";\nimport { db } from '../firebase';\nimport firebase from '../firebase';\nimport { BrowserRouter, Route, Link } from 'react-router-dom';\nimport { storage } from '../firebase';\n\nclass Mypage extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.changepost = () => {\n      this.setState({\n        postpage: false\n      });\n    };\n\n    this.post = () => {\n      this.setState({\n        postpage: false\n      });\n      this.setState({\n        postpage: true\n      });\n    };\n\n    this.state = {\n      posts: [],\n      postpage: false,\n      user: null,\n      pictureurl: \"\"\n    };\n  }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(user => {\n      this.setState({\n        user\n      });\n    });\n    const user = firebase.auth().currentUser;\n    const userdb = db.collection(\"users\").doc(user.uid);\n    firebase.database().ref('/posts').orderByChild('email').startAt(userdb.data().email).endAt(userdb.data().email).once('value', function (snapshot) {\n      console.log(snapshot.val());\n    });\n    const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc');\n    postsref.limit(20).onSnapshot(snapshot => {\n      const posts = snapshot.docs.map(postdoc => {\n        const post = postdoc.data(); //  console.log(post);\n\n        const pathref = storage.ref().child(\"images/\".concat(post.postpicname));\n        pathref.getDownloadURL().then(url => {\n          this.setState({\n            pictureurl: url\n          });\n        });\n        return {\n          title: post.title,\n          body: post.body,\n          name: post.name,\n          pic: post.pic,\n          course: post.course,\n          nickname: post.nickname,\n          favcount: post.favcount,\n          librarycount: post.librarycount,\n          timestamp: post.timestamp,\n          postpicname: post.postpicname\n        };\n      });\n      this.setState({\n        posts: posts\n      });\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, this.props.user ? this.state.postpage ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }) : this.state.posts.map((post, i) => {\n      return React.createElement(\"div\", {\n        key: i,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, post.title, post.body, post.name, post.pictureurl, post.course, post.nickname, post.favcount, post.librarycount);\n    }) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }), this.props.user ? this.state.postpage ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, React.createElement(Post, {\n      user: this.state.user,\n      postpage: this.state.postpage,\n      changepost: this.changepost,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      onClick: this.changepost,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, \"\\u6295\\u7A3F\\u3092\\u3084\\u3081\\u308B\")) : React.createElement(\"a\", {\n      className: \"btn-floating btn-large waves-effect waves-light red\",\n      onClick: this.post,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      class: \"material-icons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, \"add\")) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default Mypage;","map":{"version":3,"sources":["/Users/imatomo/Desktop/gline-react/src/components/Mypage.js"],"names":["React","Post","db","firebase","BrowserRouter","Route","Link","storage","Mypage","Component","constructor","props","changepost","setState","postpage","post","state","posts","user","pictureurl","componentDidMount","auth","onAuthStateChanged","currentUser","userdb","collection","doc","uid","database","ref","orderByChild","startAt","data","email","endAt","once","snapshot","console","log","val","postsref","orderBy","limit","onSnapshot","docs","map","postdoc","pathref","child","postpicname","getDownloadURL","then","url","title","body","name","pic","course","nickname","favcount","librarycount","timestamp","render","i"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport Post from \"./Post\"\nimport { db } from '../firebase'\nimport firebase from '../firebase'\nimport { BrowserRouter, Route, Link } from 'react-router-dom'\nimport { storage } from '../firebase'\n\n\n\nclass Mypage extends React.Component {\n    constructor(props){\n        super(props)\n        this.state={\n            posts:[],\n            postpage:false,\n            user:null,\n            pictureurl:\"\"\n\n\n        }\n    }\n\n    changepost=()=>{\n        this.setState({\n        postpage:false\n    })\n    }\n    componentDidMount(){\n     \n       \n        firebase.auth().onAuthStateChanged(user => {\n            this.setState({ user })\n          })\n          const user = firebase.auth().currentUser\n          const userdb = db.collection(\"users\").doc(user.uid);\n\n\n        firebase.database().ref('/posts')\n        .orderByChild('email').startAt(userdb.data().email).endAt(userdb.data().email)\n        .once('value',function(snapshot) {console.log(snapshot.val())})\n        const postsref = db.collection(\"posts\").orderBy('timestamp', 'desc')\n        postsref.limit(20).onSnapshot((snapshot) => {\n            const posts = snapshot.docs.map( (postdoc) =>{\n                \n                 const post = postdoc.data();\n                //  console.log(post);\n                 \n                 const pathref = storage.ref().child(`images/${post.postpicname}`)\n                 pathref.getDownloadURL().then((url)=>{\n                     this.setState({\n                        pictureurl:url\n                     })\n                 }\n                 )\n\n                return {\n                    title:post.title,\n                    body:post.body,\n                    name:post.name,\n                    pic:post.pic,\n                    course:post.course,\n                    nickname: post.nickname,\n                    favcount: post.favcount,\n                    librarycount: post.librarycount,\n                    timestamp: post.timestamp,\n                    postpicname: post.postpicname\n                }   \n               \n            })\n            this.setState({\n                posts : posts,\n                \n            })\n           \n        });\n        \n       \n\n\n    \n    }\n\n   \n    post = () =>{\n            this.setState({\n        postpage:false\n    })\n            this.setState({\n                postpage : true\n            })  \n      \n    }\n\n   \n\n    render(){\n        \n        return(\n            <div>\n\n                {this.props.user?(\n                    this.state.postpage?(\n                        <div></div>\n                    )\n                    :\n                    (\n                        this.state.posts.map((post, i) => { \n                            return ( \n                                <div key={i}>\n                                    {post.title}\n                                    {post.body}\n                                    {post.name}\n                                    {post.pictureurl}\n                                   \n                                    {post.course}\n                                    {post.nickname}\n                                    {post.favcount}\n                                    {post.librarycount}\n                                    {/* {post.timestamp.toString()} */}\n                                </div>\n                            )\n    \n                        })\n                    )\n                )   \n                :\n                (\n                    <div></div>\n                )\n                }\n            {this.props.user?(\n                this.state.postpage?(\n                    <div>\n                    <div><Post user = {this.state.user} postpage={this.state.postpage} changepost={this.changepost}/></div>\n                    <button onClick={this.changepost}>投稿をやめる</button>\n                    </div>\n                )\n                :\n                (\n                    <a className=\"btn-floating btn-large waves-effect waves-light red\" onClick={this.post}><i class=\"material-icons\">add</i></a>\n                    \n                )\n            )   \n            :\n            (\n                <div></div>\n            )\n            }\n                \n            </div>\n        );\n    }\n    \n}\n    \n     \n\n\nexport default Mypage"]},"metadata":{},"sourceType":"module"}