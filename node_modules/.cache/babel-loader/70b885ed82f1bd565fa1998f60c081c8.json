{"ast":null,"code":"import _objectSpread from \"/Users/imatomo/Desktop/gline-react/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/imatomo/Desktop/gline-react/src/components/Response.js\";\n//解答の閲覧画面のコンポーネントを編集\nimport React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport { BrowserRouter, Route, Link } from 'react-router-dom';\nimport firebase, { db, storage } from '../firebase';\n\nclass Response extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.save = e => {\n      if (this.state.files != []) {\n        e.preventDefault();\n        this.state.files.forEach(file => {\n          storage.ref().child(\"images/\".concat(file.name)).put(file).then(snap => {\n            console.log('Uploaded a blob or file!');\n          });\n        });\n      }\n\n      let id = 0;\n      let post_id = String(id);\n      const user = firebase.auth().currentUser;\n      const userdb = db.collection(\"users\").doc(user.uid);\n      userdb.get().then(userdb => {\n        if (userdb.exists) {\n          console.log(\"Document data:\", userdb.data());\n\n          if (this.state.files == null) {\n            db.collection(\"Responses\").doc().set({\n              post_id: this.props.match.params.id,\n              name: userdb.data().name,\n              pic: userdb.data().pic,\n              email: userdb.data().email,\n              course: userdb.data().course,\n              nickname: userdb.data().nickname,\n              text: this.state.text,\n              favcount: 0,\n              timestamp: new Date(),\n              responseimageurl: []\n            }).then(() => {\n              console.log(\"\\u8FFD\\u52A0\\u306B\\u6210\\u529F\\u3057\\u307E\\u3057\\u305F \");\n            }).catch(error => {\n              console.log(\"\\u8FFD\\u52A0\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F (\".concat(error, \")\"));\n            });\n          } else {\n            db.collection(\"Responses\").doc().set({\n              post_id: this.props.match.params.id,\n              name: userdb.data().name,\n              pic: userdb.data().pic,\n              email: userdb.data().email,\n              course: userdb.data().course,\n              nickname: userdb.data().nickname,\n              text: this.state.text,\n              favcount: 0,\n              timestamp: new Date(),\n              responseimageurl: this.state.responseimageurls\n            }).then(() => {\n              this.setState({\n                text: \"dsgd\",\n                responseimageurls: [],\n                files: []\n              });\n              console.log(\"\\u8FFD\\u52A0\\u306B\\u6210\\u529F\\u3057\\u307E\\u3057\\u305F \");\n            }).catch(error => {\n              console.log(\"\\u8FFD\\u52A0\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F (\".concat(error, \")\"));\n            });\n          }\n        } else {\n          // doc.data() will be undefined in this case\n          console.log(\"No such document!\");\n        }\n      }).catch(function (error) {\n        console.log(\"\\u53D6\\u5F97\\u5931\\u6557 (\".concat(error, \")\"));\n      });\n    };\n\n    this.handleFileSelect = e => {\n      const files = e.target.files;\n      Array.prototype.forEach.call(files, file => {\n        const reader = new FileReader();\n        reader.addEventListener(\"load\", () => {\n          this.setState(state => {\n            state.responseimageurls.push(reader.result);\n            state.files.push(file);\n            return state;\n          });\n        });\n\n        if (file) {\n          reader.readAsDataURL(file);\n        }\n      });\n    };\n\n    this.state = {\n      text: \"\",\n      responseimageurls: [],\n      files: [],\n      responses: []\n    };\n    this.handleInputText = this.handleInputText.bind(this);\n    this.handleFileSelect = this.handleFileSelect.bind(this);\n  }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(user => {\n      this.setState({\n        user\n      });\n    });\n    const responsesref = db.collection(\"Responses\").orderBy('timestamp', 'asc');\n    responsesref.limit(20).onSnapshot(snapshot => {\n      const responses = snapshot.docs.map(responsedoc => {\n        const response = responsedoc.data(); //  console.log(post);\n\n        if (response.responseimageurl != []) {\n          const pathref = storage.ref().child(\"images/\".concat(response.responseimageurls));\n          pathref.getDownloadURL().then(url => {\n            this.setState(state => {\n              const index = state.responses.findIndex(response => {\n                return response.id === responsedoc.id;\n              });\n              state.responses[index].responseimageurl.push(url);\n              return state;\n            });\n          });\n        }\n\n        return _objectSpread({}, response, {\n          id: responsedoc.id\n        });\n      });\n      const refid = this.props.match.params.id;\n      console.log(responses);\n      const res = responses.find(responses => {\n        return responses.post_id === refid;\n      });\n      console.log(res);\n      this.setState({\n        responses: responses.filter(responses => {\n          return responses.post_id === refid;\n        })\n      });\n    });\n  }\n\n  handleInputText(event) {\n    this.setState({\n      text: event.target.value\n    });\n  }\n\n  render() {\n    console.log(this.state.responses);\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, this.state.responses && this.state.responses.map((response, i) => {\n      return React.createElement(\"div\", {\n        key: i,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, response.text, response.responseimageurl && response.responseimageurl.map((imageurl, j) => {\n        return React.createElement(\"div\", {\n          key: j,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          src: imageurl,\n          className: \"response-image\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }));\n      }), response.course, response.nickname, response.favcount, response.librarycount);\n    }), React.createElement(\"div\", {\n      className: \"posttitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, \"\\u56DE\\u7B54\\u3092\\u5165\\u529B:\", React.createElement(\"input\", {\n      type: \"text\",\n      value: this.state.Text,\n      onChange: this.handleInputText.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"file-field input-field\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"btn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, \"File\"), React.createElement(\"input\", {\n      type: \"file\",\n      onChange: this.handleFileSelect.bind(this),\n      multiple: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"file-path-wrapper\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      className: \"file-path validate\",\n      type: \"text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    })), this.state.responseimageurls.map((imageurl, i) => {\n      return React.createElement(\"div\", {\n        key: i,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: imageurl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }));\n    })), React.createElement(\"button\", {\n      onClick: this.save,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, \"\\u56DE\\u7B54\\u3092\\u6295\\u7A3F\\u3059\\u308B\"));\n  }\n\n}\n\nexport default Response;","map":{"version":3,"sources":["/Users/imatomo/Desktop/gline-react/src/components/Response.js"],"names":["React","BrowserRouter","Route","Link","firebase","db","storage","Response","Component","constructor","props","save","e","state","files","preventDefault","forEach","file","ref","child","name","put","then","snap","console","log","id","post_id","String","user","auth","currentUser","userdb","collection","doc","uid","get","exists","data","set","match","params","pic","email","course","nickname","text","favcount","timestamp","Date","responseimageurl","catch","error","responseimageurls","setState","handleFileSelect","target","Array","prototype","call","reader","FileReader","addEventListener","push","result","readAsDataURL","responses","handleInputText","bind","componentDidMount","onAuthStateChanged","responsesref","orderBy","limit","onSnapshot","snapshot","docs","map","responsedoc","response","pathref","getDownloadURL","url","index","findIndex","refid","res","find","filter","event","value","render","i","imageurl","j","librarycount","Text"],"mappings":"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","sourcesContent":["//解答の閲覧画面のコンポーネントを編集\nimport React from \"react\";\nimport \"../bower_components/materialize/dist/css/materialize.css\";\nimport \"./style.css\";\nimport { BrowserRouter, Route, Link } from 'react-router-dom';\nimport firebase, { db, storage } from '../firebase';\n\nclass Response extends React.Component{\n    constructor(props){\n        super(props)\n        this.state={\n\n            text : \"\",\n            responseimageurls:[],\n            files:[],\n            responses:[]\n            \n         }\n         this.handleInputText = this.handleInputText.bind(this);\n         \n         this.handleFileSelect = this.handleFileSelect.bind(this);\n     }\n\n\n     componentDidMount(){\n\n        \n        firebase.auth().onAuthStateChanged(user => {\n            this.setState({ user })\n          })\n\n        const responsesref = db.collection(\"Responses\").orderBy('timestamp', 'asc')\n        responsesref.limit(20).onSnapshot((snapshot) => {\n            const responses = snapshot.docs.map( (responsedoc) =>{\n                \n                const response = responsedoc.data();\n                    //  console.log(post);\n                if(response.responseimageurl!=[]){\n                    const pathref = storage.ref().child(`images/${response.responseimageurls}`)\n                    pathref.getDownloadURL().then((url)=>{ \n\n                        this.setState((state)=>{\n                            const index =  state.responses.findIndex((response)=>{\n                                return response.id === responsedoc.id;\n                            })\n                            state.responses[index].responseimageurl.push(url)\n\n\n                            \n                            return state\n                        })\n                    })\n\n                    \n                }\n                return {...response,id:responsedoc.id}\n                \n               \n            })\n            const refid =this.props.match.params.id\n            console.log(responses)\n            const res = responses.find((responses) => {return (responses.post_id === refid);})\n            console.log(res)\n            this.setState({\n                responses : responses.filter((responses) => {return (responses.post_id === refid);}),\n                \n            })\n\n           \n          \n        });\n        \n    \n    }\n\n     save = (e) => {\n\n        \n\n        if(this.state.files!=[]){\n             e.preventDefault()\n             this.state.files.forEach((file)=>{\n                \n                 storage.ref().child(`images/${file.name}`).put(file).then(snap => {\n                     console.log('Uploaded a blob or file!');\n                 });\n             })\n         }   \n         let id =0;\n         let post_id = String(id)\n         const user = firebase.auth().currentUser\n         const userdb = db.collection(\"users\").doc(user.uid);\n         userdb.get().then((userdb) => {\n             if (userdb.exists) {\n                 console.log(\"Document data:\", userdb.data());\n             \n                     if(this.state.files==null){\n                         db.collection(\"Responses\").doc().set({\n                             post_id : this.props.match.params.id,\n                             name: userdb.data().name,\n                             pic: userdb.data().pic,\n                             email: userdb.data().email,\n                             course: userdb.data().course,\n                             nickname: userdb.data().nickname,\n                             text: this.state.text,\n                             favcount: 0,                           \n                             timestamp: new Date(),                            \n                             responseimageurl:[]\n \n                         })        \n                         .then(() => {\n                             \n                            \n                             console.log(`追加に成功しました `);\n                            \n                         })\n                         .catch((error) => {\n                             console.log(`追加に失敗しました (${error})`);\n                         });\n\n                     }else{\n                         db.collection(\"Responses\").doc().set({\n                            post_id : this.props.match.params.id,\n                             name: userdb.data().name,\n                             pic: userdb.data().pic,\n                             email: userdb.data().email,\n                             course: userdb.data().course,\n                             nickname: userdb.data().nickname,\n                             text: this.state.text,\n                             favcount: 0,                           \n                             timestamp: new Date(),      \n                             responseimageurl:this.state.responseimageurls                      \n                           \n \n \n                         })        \n                         .then(() => {\n                            this.setState({\n                                text : \"dsgd\",\n                                responseimageurls:[],\n                                files:[]\n                             })\n                             console.log(`追加に成功しました `);\n                            \n                                \n                            \n                         })\n                         .catch((error) => {\n                             console.log(`追加に失敗しました (${error})`);\n                         });\n \n \n \n                     }\n             } else {\n                 // doc.data() will be undefined in this case\n                 console.log(\"No such document!\");\n             }\n                     \n         })\n         .catch(function(error){\n         console.log(`取得失敗 (${error})`);\n             });\n             \n     }\n\n\n    handleInputText(event) {\n        this.setState({\n\n            text: event.target.value\n        })\n    }\n\n\n    handleFileSelect = (e) => {\n        const files = e.target.files\n        Array.prototype.forEach.call(files,(file) => {\n            const reader = new FileReader()\n            reader.addEventListener(\"load\",()=>{\n                this.setState((state)=>{\n                    state.responseimageurls.push(reader.result)\n                    state.files.push(file)\n                    return state\n                })\n\n             })\n            if(file){\n                reader.readAsDataURL(file)\n            }\n        });\n        \n    }\n\n    render(){\n        console.log(this.state.responses)\n        return(\n           <div>\n                 {this.state.responses&&\n                        this.state.responses.map((response,i) => { \n                        \n                    return(\n                        <div key={i}>\n                        \n                        {response.text}\n                        \n                        {response.responseimageurl&&\n                            response.responseimageurl.map((imageurl,j)=>{\n                                return (\n                                <div key={j}>\n                                <img src={imageurl} className=\"response-image\"></img>\n                                </div>\n                                )\n                            })\n                        }\n                        {response.course}\n                        {response.nickname}\n                        {response.favcount}\n                        {response.librarycount}\n                        {/* {post.timestamp.toString()} */}\n                        </div>\n                    )\n                    })\n                }\n\n            \n                      <div className=\"posttitle\">回答を入力:\n                            <input type='text' value={this.state.Text} onChange={this.handleInputText.bind(this)} />\n                        </div>\n                       \n                        <div className=\"file-field input-field\">\n                            <div className=\"btn\">\n                                <span>File</span>\n                                <input type=\"file\" onChange={this.handleFileSelect.bind(this)} multiple />\n                            </div>\n                            <div className=\"file-path-wrapper\">\n                                <input className=\"file-path validate\" type=\"text\"/>\n                            </div>\n                            {\n                                this.state.responseimageurls.map((imageurl,i)=>{\n                                    return (\n                                    <div key={i}>\n                                        <img src={imageurl}></img>\n                                    </div>\n                                    )\n                                })\n                            }\n                            \n                        </div>\n                        <button onClick={this.save}>回答を投稿する</button>\n             </div>\n                \n        );\n        \n    }\n}\n\nexport default Response\n"]},"metadata":{},"sourceType":"module"}